---
title: Linux初始化及挂载数据盘
date: 2018-12-12 11:24:40
tags: Linux

---

## 磁盘分区形式
常用的磁盘分区形式如下表所示，并且针对Linux操作系统，不同的磁盘分区形式需要选择不同的分区工具。

磁盘分区形式|支持最大磁盘容量|支持分区数量|Linux分区工具
---|:--:|:--|:---
主启动记录分区（MBR）|2TB|<li>4个主分区</li><li>3个主分区和1个扩展分区</li><br>说明：<br>MBR分区包含主分区和扩展分<br>区，其中扩展分区里面可以包<br>含若干个逻辑分区。以创建六<br>个分区为例，以下两种分区情<br>况供参考：<br><li>3个主分区，一个扩展分区，<br>其中扩展分区包含3个逻辑分<br>区。</li><li>1个主分区，1个扩展分区，<br>其中扩展分区中包含5个逻辑<br>分区。</li>|以下两种工具均可以使用：<br><li>fdisk工具</li><li>parted工具</li>
全局分区表<br>(GPT, Guid Partition Table)|18EB<br>(1EB=1048576TB)|不限制分区数量<br>说明：<br>GPT格式下没有主分区、扩展分区以及逻辑分区之分|parted工具

>注意事项：
>MBR格式分区最大支持的容量是2TB，如果硬盘的容量大于2TB，则必须选择GPT的分区形式，并且使用parted进行分区。当磁盘已经投入使用后，此时切换磁盘分区形式时，磁盘上的原有数据将会被清除，因此请在磁盘初始化时谨慎选择磁盘分区形式。

## 使用fdisk工具初始化磁盘（只支持小于2TB的硬盘）
1. `fdisk -l`查看新增数据盘的信息，一般可以看到例如`/dev/sdb`这样的新增盘，主要依据是根据显示的信息中显示的硬盘大小以及是否有分区。
	一般会显示如下信息（以下信息为分区后的情况，若新硬盘会看到一个没有分区的磁盘）：
	
	```bash
	磁盘 /dev/sda：1000.2 GB, 1000204886016 字节，1953525168 个扇区
	Units = 扇区 of 1 * 512 = 512 bytes
	扇区大小(逻辑/物理)：512 字节 / 4096 字节
	I/O 大小(最小/最佳)：4096 字节 / 4096 字节
	磁盘标签类型：dos
	磁盘标识符：0x000c5dbf
	
	   设备 Boot      Start         End      Blocks   Id  System
	/dev/sda1            2048   125001727    62499840   82  Linux swap / Solaris
	/dev/sda2   *   125001728  1953523711   914260992   83  Linux
	
	磁盘 /dev/sdb：6001.2 GB, 6001175126016 字节，11721045168 个扇区
	Units = 扇区 of 1 * 512 = 512 bytes
	扇区大小(逻辑/物理)：512 字节 / 4096 字节
	I/O 大小(最小/最佳)：4096 字节 / 4096 字节
	磁盘标签类型：gpt
	Disk identifier: E9D9D767-8701-4230-BFAC-07F103EBB35A
	
	
	\#         Start          End    Size  Type            Name
	 1         2048  11721043967    5.5T  Microsoft basic data
	```
2. `fdisk 新增数据盘`，例如`fdisk /dev/sdb`
3. 输入n，按Enter开始新建分区，这里n代表new
4. 接下来会让我们选择p还是e，p代表主要分区，e代表延伸分区，对于新增加的硬盘一般选择p
5. 选择分区号，对于新增硬盘，一般选择1
6. 选择初始磁柱编号，新增硬盘选择默认的2048即可
7. 选择截止磁柱区域，选择默认的最大的磁柱区域即可，表示只建立一个分区，这个分区使用了硬盘的所有容量
8. 输入p，可以看到我们已经新建好的硬盘分区为`/dev/sdb1`
9. 输入w，按Enter将分区结果写入分区表
10. 执行`partprobe`将新的分区表变更同步至操作系统

## 使用parted工具初始化磁盘（可以支持大于2TB的硬盘）
1. `lsblk`查看新增数据盘信息，和上一个介绍的工具的`fdisk -l`的效果是一样的，可以看到例如`/dev/sdb`这样的新增盘，并且这种方式显示出来的结果更加直观一点，冗余的信息比较少。
	一般会显示如下信息（以下信息为分区后的情况，若新硬盘会看到一个没有分区的磁盘）：
	
	```bash
	NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
	sda      8:16   0 931.5G  0 disk
	├─sda1   8:17   0  59.6G  0 part
	└─sda2   8:18   0 871.9G  0 part /
	sdb      8:0    0   5.5T  0 disk
	└─sdb1   8:1    0   5.5T  0 part /mnt/data
	```
2. `parted 新增数据盘`，例如`parted /dev/sdb`
3. 输入p，按Enter查看当前磁盘的分区形式
4. 输入以下命令，设置磁盘分区形式。`mklabel 磁盘分区形式`，这里磁盘分区形式可以选择GPT和MBR，当然，大于2TB的硬盘只能选择GPT
5. 输入`unit s`，按Enter，设置磁盘的计量单位为磁柱
6. 以为整个磁盘创建一个分区为例，输入`mkparted data 2048s 100%`，按Enter。这里data为分区名称，2048s表示初始磁柱位置，100%表示从初始磁柱位置开始，占用100%的磁盘容量进行新建分区
7. 输入q，按Enter，退出parted

## 格式化数据盘及挂载数据盘
数据盘分区好之后是不能直接挂载的，会显示unknown filesystem，需要进行格式化指定一个磁盘文件格式，以ext4格式为例，使用如下指令进行格式化:

```bash
mkfs -t ext4 /dev/sdb1
```
之后便可以新建一个文件夹，例如`/mnt/data`将新硬盘挂载到该文件夹下，输入如下指令：

```bash
mount /dev/sdb1 /mnt/data
```

这样做只能即使生效，重启后需要重新输入指令进行挂载，十分不方便，可以将磁盘挂载写入到`/etc/fstab`文件当中，这样就可以省去每次开机挂载的繁琐操作。首先使用`blkid /dev/sdb1`来查看新增分区的UUID号是多少，复制UUID，编辑`/etc/fstab`文件，在末尾加入一行:

```bash
UUID=1851e23f-1c57-40ab-86bb-5fc5fc606ffa /mnt/data      ext4 defaults     0   2
```

